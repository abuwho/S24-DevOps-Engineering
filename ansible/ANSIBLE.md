# Ansible

1. Repository Structure: Done as advised

2. Installing Ansible
    ```sh
    python3 -m pip install --user ansible
    ```

3. Adding an existing role for Docker
    ```sh
    ansible-galaxy role install geerlingguy.docker
    ```
4. Running a playbook

    ```sh
    $ ansible-playbook playbooks/dev/main.yaml --diff

    PLAY [Install Docker and Docker Compose] ************************************************************************************************************************************************

    TASK [Gathering Facts] ******************************************************************************************************************************************************************
    ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

    TASK [docker : Download pip installation script] ****************************************************************************************************************************************
    ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

    TASK [docker : Install pip] *************************************************************************************************************************************************************
    ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

    TASK [docker : Refresh apt packages] ****************************************************************************************************************************************************
    ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

    TASK [docker : Install/Update docker.io] ************************************************************************************************************************************************
    ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

    TASK [docker : Install docker] **********************************************************************************************************************************************************
    ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

    TASK [docker : Install docker-compose] **************************************************************************************************************************************************
    ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

    PLAY RECAP ******************************************************************************************************************************************************************************
    ec2-18-170-41-216.eu-west-2.compute.amazonaws.com : ok=7    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
    ```


5. Inventory details
```
    $ ansible-inventory --list
    {
        "_meta": {
            "hostvars": {
                "ec2-18-170-41-216.eu-west-2.compute.amazonaws.com": {
                    "ansible_connection": "ssh",
                    "ansible_user": "ubuntu"
                }
            }
        },
        "all": {
            "children": [
                "ungrouped"
            ]
        },
        "ungrouped": {
            "hosts": [
                "ec2-18-170-41-216.eu-west-2.compute.amazonaws.com"
            ]
        }
    }
```

### Best practices
- Implements suggested repository structure
- Uses `ansible.cfg` for configurations
- Implements modular tasks


### Lab 6

### For `app_python`
```bash
$ ansible-playbook playbooks/dev/app_python/main.yml 

PLAY [Install docker] ********************************************************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Download pip installation script] *****************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install pip] **************************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Refresh apt packages] *****************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install/Update docker.io] *************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install docker] ***********************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install docker-compose] ***************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

PLAY [Deploying Python web app] **********************************************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Download pip installation script] *****************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install pip] **************************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Refresh apt packages] *****************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install/Update docker.io] *************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install docker] ***********************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install docker-compose] ***************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Check if docker-compose file exists] *************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Stop docker container] ***************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Remove Docker images] ****************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Remove compose file] *****************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Create directory] ********************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Copy template] ***********************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Stop containers] *********************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Run docker-compose] ******************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

PLAY RECAP *******************************************************************************************************************************************************************************
ec2-18-170-41-216.eu-west-2.compute.amazonaws.com : ok=22   changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

```

### For `app_go`:
```bash
$ ansible-playbook playbooks/dev/app_go/main.yml 

PLAY [Install docker] ********************************************************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Download pip installation script] *****************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install pip] **************************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Refresh apt packages] *****************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install/Update docker.io] *************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install docker] ***********************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install docker-compose] ***************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

PLAY [Deploying Go web app] **************************************************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Download pip installation script] *****************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install pip] **************************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Refresh apt packages] *****************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install/Update docker.io] *************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install docker] ***********************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [docker : Install docker-compose] ***************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Check if docker-compose file exists] *************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Stop docker container] ***************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Remove Docker images] ****************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Remove compose file] *****************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Create directory] ********************************************************************************************************************************************************
ok: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Copy template] ***********************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Stop containers] *********************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

TASK [web_app : Run docker-compose] ******************************************************************************************************************************************************
changed: [ec2-18-170-41-216.eu-west-2.compute.amazonaws.com]

PLAY RECAP *******************************************************************************************************************************************************************************
ec2-18-170-41-216.eu-west-2.compute.amazonaws.com : ok=22   changed=6    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```

### Status on AWS EC2 instance (via SSH): 

```bash
ubuntu@ip-172-31-8-230:~$ sudo docker ps
CONTAINER ID   IMAGE                      COMMAND                  CREATED              STATUS              PORTS                                       NAMES
836ac14c257d   abuwho/app_go:latest       "./main"                 About a minute ago   Up About a minute   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   app_go_web_1
775930b54b4d   abuwho/app_python:latest   "python3 -m flask ru…"   3 minutes ago        Up 3 minutes        0.0.0.0:5000->5000/tcp, :::5000->5000/tcp   app_python_web_1
```


### Best practices employed
1. Suitable naming conventions were used.
2. Tasks were grouped, roles were separated logically. 
3. Templates were used to keep it DRY.